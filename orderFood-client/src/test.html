<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>XX快餐店 - 自助点餐</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", sans-serif;
        }

        body {
            background-color: #f8f8f8;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* 禁止整体滚动 */
        }

        /* 顶部标题栏 */
        .header {
            background-color: #e63946;
            color: white;
            padding: 12px 15px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .header h1 {
            font-size: 28px;
            font-weight: bold;
        }

        /* 分类标签栏 */
        .category-tabs {
            display: flex;
            background-color: white;
            padding: 10px 15px;
            gap: 10px;
            overflow-x: auto; /* 分类多了横向滚动 */
            box-shadow: 0 2px 3px rgba(0,0,0,0.05);
            z-index: 9;
        }

        .category-tab {
            padding: 8px 18px;
            background-color: #f5f5f5;
            border-radius: 20px;
            font-size: 18px;
            font-weight: 500;
            color: #333;
            cursor: pointer;
            white-space: nowrap; /* 防止分类名换行 */
            border: none;
        }

        .category-tab.active {
            background-color: #e63946;
            color: white;
        }

        /* 主体内容区 - 只滚动中间套餐列表 */
        .main-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* 套餐列表区 - 高度自适应，仅此处滚动 */
        .meal-list {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
        }

        .meal-group {
            display: none; /* 默认隐藏所有分类 */
        }

        .meal-group.active {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        /* 套餐卡片 - 紧凑布局，减少滚动 */
        .meal-card {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .meal-card:hover {
            transform: scale(1.02);
        }

        .meal-img {
            width: 100px;
            height: 100px;
            border-radius: 8px;
            object-fit: cover;
            flex-shrink: 0; /* 图片不压缩 */
        }

        .meal-info {
            flex: 1;
        }

        .meal-name {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .meal-desc {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
        }

        .meal-price {
            font-size: 22px;
            color: #e63946;
            font-weight: bold;
        }

        .add-btn {
            background-color: #ffb703;
            border: none;
            color: white;
            padding: 8px 15px;
            font-size: 16px;
            border-radius: 20px;
            cursor: pointer;
            flex-shrink: 0;
        }

        .add-btn:hover {
            background-color: #fb8500;
        }

        /* 购物车 - 固定在底部，新增数量控制样式 */
        .cart-section {
            background-color: white;
            padding: 15px;
            box-shadow: 0 -3px 8px rgba(0,0,0,0.1);
            z-index: 10;
        }

        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .cart-title {
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }

        .cart-empty {
            font-size: 16px;
            color: #999;
            text-align: center;
            padding: 10px 0;
        }

        .cart-items {
            max-height: 120px; /* 最多显示3条，超出滚动 */
            overflow-y: auto;
            margin-bottom: 10px;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            font-size: 16px;
            border-bottom: 1px solid #eee;
        }

        .cart-item-name {
            color: #333;
            flex: 1;
        }

        /* 新增：数量控制按钮样式 */
        .quantity-control {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-right: 10px;
        }

        .num-btn {
            width: 26px;
            height: 26px;
            border-radius: 50%;
            border: 1px solid #e63946;
            color: #e63946;
            background-color: white;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }

        .num-btn:disabled {
            border-color: #ccc;
            color: #ccc;
            cursor: not-allowed;
        }

        .cart-item-num {
            font-size: 16px;
            width: 30px;
            text-align: center;
        }

        .cart-item-price {
            color: #e63946;
            font-weight: bold;
            min-width: 80px;
            text-align: right;
        }

        .checkout-area {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 10px;
            border-top: 2px solid #eee;
        }

        .total-price {
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }

        .total-price span {
            color: #e63946;
        }

        .pay-btn {
            padding: 10px 25px;
            background-color: #e63946;
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
        }

        .pay-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>XX快餐店 自助点餐</h1>
    </div>

    <!-- 分类标签栏 -->
    <div class="category-tabs">
        <button class="category-tab active" onclick="switchCategory('main')">主食套餐</button>
        <button class="category-tab" onclick="switchCategory('snack')">小食</button>
        <button class="category-tab" onclick="switchCategory('drink')">饮品</button>
    </div>

    <div class="main-container">
        <!-- 套餐列表 -->
        <div class="meal-list">
            <!-- 主食套餐分类 -->
            <div class="meal-group active" id="main">
                <div class="meal-card">
                    <img src="https://picsum.photos/seed/meal1/200/200" alt="经典汉堡套餐" class="meal-img">
                    <div class="meal-info">
                        <div class="meal-name">经典汉堡套餐</div>
                        <div class="meal-desc">汉堡+薯条+可乐</div>
                        <div class="meal-price">¥39.00</div>
                    </div>
                    <button class="add-btn" onclick="addToCart(1, '经典汉堡套餐', 39)">+ 加入</button>
                </div>
                <div class="meal-card">
                    <img src="https://picsum.photos/seed/meal2/200/200" alt="炸鸡套餐" class="meal-img">
                    <div class="meal-info">
                        <div class="meal-name">炸鸡套餐</div>
                        <div class="meal-desc">香辣炸鸡+薯条+可乐</div>
                        <div class="meal-price">¥45.00</div>
                    </div>
                    <button class="add-btn" onclick="addToCart(2, '炸鸡套餐', 45)">+ 加入</button>
                </div>
                <div class="meal-card">
                    <img src="https://picsum.photos/seed/meal3/200/200" alt="全家桶套餐" class="meal-img">
                    <div class="meal-info">
                        <div class="meal-name">全家桶套餐</div>
                        <div class="meal-desc">8块炸鸡+2杯可乐+薯条</div>
                        <div class="meal-price">¥128.00</div>
                    </div>
                    <button class="add-btn" onclick="addToCart(3, '全家桶套餐', 128)">+ 加入</button>
                </div>
            </div>

            <!-- 小食分类 -->
            <div class="meal-group" id="snack">
                <div class="meal-card">
                    <img src="https://picsum.photos/seed/snack1/200/200" alt="薯条" class="meal-img">
                    <div class="meal-info">
                        <div class="meal-name">香脆薯条</div>
                        <div class="meal-desc">大份</div>
                        <div class="meal-price">¥12.00</div>
                    </div>
                    <button class="add-btn" onclick="addToCart(4, '香脆薯条', 12)">+ 加入</button>
                </div>
                <div class="meal-card">
                    <img src="https://picsum.photos/seed/snack2/200/200" alt="鸡翅" class="meal-img">
                    <div class="meal-info">
                        <div class="meal-name">香辣鸡翅</div>
                        <div class="meal-desc">2对</div>
                        <div class="meal-price">¥18.00</div>
                    </div>
                    <button class="add-btn" onclick="addToCart(5, '香辣鸡翅', 18)">+ 加入</button>
                </div>
            </div>

            <!-- 饮品分类 -->
            <div class="meal-group" id="drink">
                <div class="meal-card">
                    <img src="https://picsum.photos/seed/drink1/200/200" alt="可乐" class="meal-img">
                    <div class="meal-info">
                        <div class="meal-name">可乐</div>
                        <div class="meal-desc">500ml</div>
                        <div class="meal-price">¥6.00</div>
                    </div>
                    <button class="add-btn" onclick="addToCart(6, '可乐', 6)">+ 加入</button>
                </div>
                <div class="meal-card">
                    <img src="https://picsum.photos/seed/drink2/200/200" alt="柠檬茶" class="meal-img">
                    <div class="meal-info">
                        <div class="meal-name">柠檬茶</div>
                        <div class="meal-desc">500ml</div>
                        <div class="meal-price">¥8.00</div>
                    </div>
                    <button class="add-btn" onclick="addToCart(7, '柠檬茶', 8)">+ 加入</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 底部固定购物车（新增数量加减按钮） -->
    <div class="cart-section">
        <div class="cart-header">
            <div class="cart-title">我的购物车</div>
        </div>
        <div class="cart-items" id="cartItems">
            <div class="cart-empty">暂无商品</div>
        </div>
        <div class="checkout-area">
            <div class="total-price">总计：<span>¥0.00</span></div>
            <button class="pay-btn" id="payBtn" disabled onclick="payAndPrint()">立即付款</button>
        </div>
    </div>

    <script>
        let cartData = [];
        let currentCategory = 'main';

        // 切换分类
        function switchCategory(categoryId) {
            // 切换分类标签样式
            document.querySelectorAll('.category-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // 切换套餐列表显示
            document.querySelectorAll('.meal-group').forEach(group => {
                group.classList.remove('active');
            });
            document.getElementById(categoryId).classList.add('active');
            currentCategory = categoryId;
        }

        // 加入购物车
        function addToCart(id, name, price) {
            const existingItem = cartData.find(item => item.id === id);
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cartData.push({ id, name, price, quantity: 1 });
            }
            updateCartUI();
        }

        // 新增：减少商品数量
        function decreaseQuantity(id) {
            const itemIndex = cartData.findIndex(item => item.id === id);
            if (itemIndex > -1) {
                // 数量大于1时减1，等于1时删除该商品
                if (cartData[itemIndex].quantity > 1) {
                    cartData[itemIndex].quantity -= 1;
                } else {
                    cartData.splice(itemIndex, 1);
                }
                updateCartUI();
            }
        }

        // 新增：增加商品数量
        function increaseQuantity(id) {
            const existingItem = cartData.find(item => item.id === id);
            if (existingItem) {
                existingItem.quantity += 1;
                updateCartUI();
            }
        }

        // 更新购物车UI（新增数量按钮渲染）
        function updateCartUI() {
            const cartItemsEl = document.getElementById('cartItems');
            const totalPriceEl = document.querySelector('.total-price span');
            const payBtn = document.getElementById('payBtn');

            // 计算总价
            let total = 0;
            cartData.forEach(item => total += item.price * item.quantity);
            totalPriceEl.textContent = `¥${total.toFixed(2)}`;
            payBtn.disabled = cartData.length === 0;

            // 空购物车提示
            if (cartData.length === 0) {
                cartItemsEl.innerHTML = '<div class="cart-empty">暂无商品</div>';
                return;
            }

            // 渲染带数量控制的购物车项
            let cartHtml = '';
            cartData.forEach(item => {
                cartHtml += `
                    <div class="cart-item">
                        <div class="cart-item-name">${item.name}</div>
                        <div class="quantity-control">
                            <button class="num-btn" onclick="decreaseQuantity(${item.id})" ${item.quantity <= 1 ? 'disabled' : ''}>-</button>
                            <span class="cart-item-num">${item.quantity}</span>
                            <button class="num-btn" onclick="increaseQuantity(${item.id})">+</button>
                        </div>
                        <div class="cart-item-price">¥${(item.price * item.quantity).toFixed(2)}</div>
                    </div>
                `;
            });
            cartItemsEl.innerHTML = cartHtml;
        }

        // 付款打印逻辑
        async function payAndPrint() {
            const total = document.querySelector('.total-price span').textContent;
            if (!confirm(`确认支付 ${total} 吗？`)) return;

            const orderData = {
                order_id: 'ORD' + Date.now(),
                time: new Date().toLocaleString(),
                items: cartData,
                total_amount: parseFloat(total.replace('¥', ''))
            };

            try {
                const response = await fetch('http://localhost:8000/print-receipt', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(orderData)
                });
                const result = await response.json();
                if (result.print_status) {
                    alert('付款成功！小票已打印');
                    cartData = [];
                    updateCartUI();
                } else {
                    alert('付款成功，小票打印失败，请联系店员');
                }
            } catch (err) {
                console.error(err);
                alert('网络异常，请联系店员');
            }
        }
    </script>
</body>
</html>