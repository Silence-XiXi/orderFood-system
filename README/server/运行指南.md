# 自助点单系统运行指南

## 后端运行步骤

### 1. 安装依赖

**重要：** 由于 `ffi-napi` 等原生模块需要编译（需要 Visual Studio Build Tools），建议从 `queueSystem-server` 复制已编译的模块。

**方法一：自动复制（推荐）**

```powershell
cd orderFood-server
npm install
```

安装脚本会自动从 `queueSystem-server` 复制已编译的原生模块。

**方法二：手动运行复制脚本**

如果自动复制失败，可以手动运行：

```powershell
cd orderFood-server
node install-native-modules.js
```

**方法三：如果 queueSystem-server 也没有编译好的模块**

需要安装 Visual Studio Build Tools（包含 Windows SDK）：
1. 下载：https://visualstudio.microsoft.com/downloads/#build-tools-for-visual-studio-2022
2. 安装时选择：C++ 生成工具 和 Windows 10/11 SDK
3. 然后运行：`npm install`

### 2. 启动后端服务器

**开发模式（自动重启）：**
```powershell
npm run dev
```

**生产模式：**
```powershell
npm start
```

### 3. 确认服务器启动

看到以下信息表示启动成功：
```
========================================
自助点单系统服务器启动成功！
========================================
本地访问地址:
  http://localhost:3002
  http://127.0.0.1:3002

网络访问地址:
  http://[你的IP]:3002

API接口:
  创建订单: POST http://[你的IP]:3002/api/orderfood/orders
  获取套餐: GET http://[你的IP]:3002/api/orderfood/meals
```

### 4. 修改端口（可选）

如果需要使用其他端口：

```powershell
$env:PORT=8080
npm start
```

## 前端运行步骤

### 1. 安装依赖

打开新的 PowerShell 窗口，进入前端目录：

```powershell
cd orderFood-client
npm install
```

### 2. 启动前端开发服务器

```powershell
npm run dev
```

### 3. 访问前端

浏览器会自动打开，或手动访问：
- 本地：`http://localhost:5173`
- 网络：`http://[你的IP]:5173`

### 4. 配置后端地址（如果需要）

如果后端不在 `127.0.0.1:3002`，可以通过环境变量配置：

```powershell
$env:VITE_API_TARGET="http://192.168.1.100:3002"
npm run dev
```

## 完整运行流程

### 方式一：两个 PowerShell 窗口

**窗口1 - 后端：**
```powershell
cd orderFood-server
npm install
npm start
```

**窗口2 - 前端：**
```powershell
cd orderFood-client
npm install
npm run dev
```

### 方式二：使用后台任务（PowerShell）

**启动后端（后台）：**
```powershell
cd orderFood-server
Start-Job -ScriptBlock { npm start } -Name OrderFoodServer
```

**启动前端：**
```powershell
cd orderFood-client
npm run dev
```

**停止后端：**
```powershell
Stop-Job -Name OrderFoodServer
Remove-Job -Name OrderFoodServer
```

## 常见问题

### 1. 端口被占用

如果 3002 端口被占用，修改后端端口：
```powershell
$env:PORT=8080
cd orderFood-server
npm start
```

然后修改前端配置 `vite.config.js` 中的 `API_TARGET`，或使用环境变量：
```powershell
$env:VITE_API_TARGET="http://127.0.0.1:8080"
cd orderFood-client
npm run dev
```

### 2. 原生模块安装失败

如果看到 `ffi-napi` 编译错误：

**方法一：从 queueSystem-server 复制（推荐）**
```powershell
cd orderFood-server
node install-native-modules.js
```

**方法二：安装 Visual Studio Build Tools**
1. 下载：https://visualstudio.microsoft.com/downloads/#build-tools-for-visual-studio-2022
2. 安装时选择：C++ 生成工具 和 Windows 10/11 SDK
3. 然后运行：`npm install`

### 3. 数据库初始化失败

如果看到数据库相关错误，确保已安装 sqlite3：
```powershell
cd orderFood-server
node install-native-modules.js  # 会同时复制 sqlite3
```

### 4. 打印机初始化失败

如果打印机 DLL 未加载，系统会以模拟模式运行，不影响订单创建功能。

### 5. 前端无法连接后端

检查：
1. 后端是否已启动
2. 后端端口是否正确
3. 前端 `vite.config.js` 中的 `API_TARGET` 配置是否正确
4. 防火墙是否阻止了连接

## 测试系统

1. 打开前端页面：`http://localhost:5173`
2. 选择一个套餐（一菜或两菜）
3. 点击"确认付款"
4. 查看后端控制台，应该看到订单创建和打印日志
5. 检查数据库文件 `orderFood-server/database.sqlite` 中是否有订单记录
